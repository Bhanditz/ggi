- if @taxon
  - vernacular_en = @taxon.vernacularNames.find{|n| n[:language] == 'en' && n[:eol_preferred] rescue false}[:vernacularName].capitalize rescue nil
  %article
    %header
      %h1
        = "%s %s" % [@taxon.rank, @taxon.name]
      - if vernacular_en
        %p= vernacular_en

    %section.information
      %header
        %h2 Taxonomic information
      %dl
        - unless @taxon.ancestors.empty?
          %dt Classification
          %dd
            = [@taxon.ancestors.first, @taxon.ancestors.last].uniq.map{|a| capture_haml(a){|an| haml_tag :a, an.name, { href: an.id} }}.join(" &gt; ").gsub("\n", '')
        %dt Scientific name
        %dd= @taxon.name
        - if vernacular_en
          %dt English common name
          %dd= vernacular_en
        - unless @taxon.rank == 'Family'
          -# FIXME count families
          %dt Number of families
          %dd ??
        %dt Source
        %dd= @taxon.source
        - # FIXME calculate total score
        %dt Total score
        %dd ??
      - if @taxon.image
        %figure
          %img{ src: @taxon.image[:eolThumbnailURL], alt: "Image of #{@taxon.name}" }
          - [:rightsHolder, :rights, :license].each do |attribute|
            - if @taxon.image[attribute]
              %p= @taxon.image[attribute]

    - if @taxon.rank == 'Family'
      %section.assessment
        %header
          %h2 Assessment
        %table
          %caption= "Assessment of knowledge about #{@taxon.name}"
          %thead
            %tr
              %th{ scope: 'col' } Source
              %th{ scope: 'col' } Value
              %th{ scope: 'col' } Score
          %tbody
            - @taxon.measurements.each do |measurement|
              - score = measurement[:score].to_f
              - # FIXME add helper method to set html class for styling poor, average, good
              - klass = nil
              %tr
                %th{ scope: 'row' }= measurement[:label]
                %td= measurement[:measurementValue]
                %td{class: klass}= measurement[:score]
        %aside
          %header
            %h3 Legend
          %p Measurement of knowledge
          %ul
            %li 0.64 to 1.0 Good
            %li 0.34 to 0.63 Average
            %li 0 to 0.33 Poor

- else
  %p Taxon information is missing
